
+新增
+新增判断物体能否被隔壁的滑块消除hit到？
+补充局面时如果失败了怎么处理？
	-避免导致无法生成新局面，进入死循环，导致卡死

+物体新增属性，消除时能否hit周边的格子
+物体新增属性，能否被周边格子的消除hit到
+物体新增属性，合成特效时，能被替换掉
+合成特效时能被替换掉



+使用道具时判断是否使用成功
	如对空格子或者格子里没有可消除的东西使用锤子时


一次操作完了之后，局面扫描。
+1.局面静止判定，如果局面静止
    +2.关卡是否结束判定，
    	如果未结束
			+3.各种物体的行为。
		关卡结束
+用户操作结束
+回合自动操作结束判定



+添加备用关卡初始化模板库
	当初始化关卡多次未能随机出合适的局面，从模板库里随机出一个
	提供自动生成模板库功能
	提供模板库预览功能



+填充局面策略
	如果不允许形成Match
		最大尝试次数50次，超过50次则允许形成Match
	填充局面成功后
	至少保证1次不是死局，



引爆特效块，但是特效块上有附着物时怎么处理


实时局面
	UpdateGravity
	CheckSituation

非实时局面
	1.消除
	2.补子下落
	3.查找可消除元素
		有可消除回到步骤1
		没有可消除继续
	4.判定关卡是否结束
		关卡结束，BonusTime
		关卡未结束继续
	5. 1）尝试引爆所有的河豚炸弹
			如果有河豚炸弹回到步骤1
		2）尝试鸡窝释放技能
			如果释放了技能回到步骤3
		3）尝试释放大眼仔技能
			如果释放完了技能，继续往下走
		4）尝试移动灰毛球
			如果移动了灰毛球，回到步骤3
		5）尝试移动老鼠
			如果移动了老鼠，继续往下走
		6）尝试扩散毒液
			如果扩散了毒液，继续往下走
		7）尝试改变变色球颜色
			如果改变了变色球颜色，继续往下走
	6.查找Move, UpdateMove
		如果有Move，回合结束
		如果没有Move，刷新局面，回到步骤3







bug:
	1.关卡一开始就会触发levelstart的指引，关卡1，一开始就checkSitation，并调用了AfterPostLoadSubLevel.
	2.使用锤子锤礼物盒，hitInfo的coordArry为空，难道礼物盒的corodList为空？26关
	3.90关有滑块的GameObject没有被回收
	4.123关用锤子砸掉一个滑块后，消除了一块冰棒，但是没有滑块落下来，没有刷新gravity
	5.步数快消耗完时，临时道具的提示的层级比失败界面高
	6.剩余步数太多没有触发将步数转化成特效
	7.开局如果有消除，则不会刷新局面




非即时模式
	有格子空出来并且可以添加滑块的时候，
	 	此时如果局面已经静止，则直接SpawnAndGravity，否则标记gravity为dirty
	当ItemInfo的状态改变时，扫描局面，如果局面已经静止，则直接spawnAndGravity

	spawnAndGravity结束后，即所有的滑块都掉落完毕时，CheckSituation.


所有会创建新滑块的地方
	levelManager加载关卡 				关卡都加载完刷新局面
	gravityManager补块					滑块都运动完刷新局面
	blockEmitterInfo发射新滑块			滑块都发射完刷新局面
	AddMergeKitty添加合成新滑块			






	使用完道具
		强制交换道具
			交换玩重新检测局面
		小木槌：
			消除完，如果格子能补滑块，则更新重力
			如果消除的是滑块，并且滑块是某个Move的滑块，并且格子无法补滑块则刷新局面，
		魔法棒：
			变成菱形炸弹后，如果滑块是某个Move的滑块，刷新局面

	ProcessMove
		->ProcessSolution		
		->非即时模式，
			等所有的消除都结束了，更新重力
			等重力更新完刷新局面，
	    ->即时模式，
	    	当有GameItem消除时，如果格子可以补块，则更新重力
	    	否则，如果局面静止则刷新局面。
	    	
	    	如果有滑块已经落到格子，如果是香蕉则直接消除，否则尝试查找新补的滑块是否能消除
	    	如果是最后一块




检测局面：
	1.查找现成的三消，
		有消除，返回
		没有，继续往下
	2.局面是否静止，
		非静止，分会
		静止，继续往下	
	3.机关行为
	  如果机关行为
	
	4.关卡结果检测
		关卡已结束，返回
		关卡未结束， 继续
	5.查找Move
		如果找到了Move继续，
		如果没有找到Move，刷新局面
		

直接调用CheckSituation的地方
	加载完关卡
	所有的滑块都掉落结束
	setdirtyba





	XMatchController中遍历Item.Update
	item.Update()，onKittyDropDown会调用LevelFinishCheck，会导致清空itemList


	itemChanges时检测局面或者消除的问题：
		当彩虹和特效块互换时，有可能会有三消