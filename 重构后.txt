enum XItemType
{
	Undefined = 0,
	// 1-30 滑块
	Normal = 1,             //普通滑块
	VerticalBomb = 2,       //竖炸弹
	HorizonBomb = 3,        //横炸弹
	RhombicBomb = 4,        //菱形炸弹
	UniversalColor = 5,     //彩虹滑块
	Banana = 6,             //香蕉
	GlobeFish = 7,          //河豚
	GlobeFishBomb = 8,      //河豚炸弹
	SquareBomb = 9,         //九宫格方形炸弹
    CountDownBomb = 10,     //倒计时炸弹
    OneEye = 11,            //大眼仔
    PresentBox = 12,        //礼物盒

    // 1-60 block
    Mouse = 31
    MouseHole = 32
    Bush = 33
    Egg = 34

    // 61-90 ground

    // 91-120 attachmentItem

    // 121-150 multigridItem
}


struct XHitInfo
{
	bool isDirectly;
	XDestructType destructType;
	XItemType triggerItemType;
}

XRespawn
	public abstruct void PlayInAnimation(float delay);
	public abstruct void playOutAnimation(float delay);

XBaseItem : XRespawn
	private XItemType itemType;
	private int _maxHP;
	private int _curHp;
	protected abstruct void OnHpChange();
	public abstruct void OnHit(XHitInfo hitInfo);	
	protected abstruct void Destruct(XHitInfo hitInfo);
	protected virtual void PlayOnHitSFx();
	protected virtual void PlayOnHitFx();	
	public virtual void LevelFinishDestruct();


XBaseKitty : XBaseItem

XGround : XBaseItem

XBlock : XBaseItem

XMultiGridItem : XBaseItem


XGrid : XRespawn
	public XGridInfo gridInfo
	public Dictionary<XItemType, XBaseItem> itemDict;
	public void OnHit()
	{
		if (有障碍物)
		else if(有附着物)
		else
		{
			if (有滑块)
			if (有冰块)
		}
	}

	void HitByNeibour(XHitInfo hitInfo)
	{

	}

	void OnSwapItemFinished();
	void OnItemMoveFinished();
	void TryDestructBanana();



重构后需要测试的功能：
	正常的三消，掉落，障碍物，地形，多格子物体的基础功能是否正常，
	刷新局面


+新增
+新增判断物体能否被隔壁的滑块消除hit到？
+补充局面时如果失败了怎么处理？
	-避免导致无法生成新局面，进入死循环，导致卡死

+物体新增属性，消除时能否hit周边的格子
+物体新增属性，能否被周边格子的消除hit到
+物体新增属性，合成特效时，能被替换掉
+合成特效时能被替换掉

填充局面


刷新局面
	每一帧尝试刷新20次，刷新50帧，1000次后允许形成三消



+使用道具时判断是否使用成功
	如对空格子或者格子里没有可消除的东西使用锤子时


一次操作完了之后，局面扫描。
+1.局面静止判定，如果局面静止
    +2.关卡是否结束判定，
    	如果未结束
			+3.各种物体的行为。
		关卡结束
+用户操作结束
+回合自动操作结束判定





+添加备用关卡初始化模板库
	当初始化关卡多次未能随机出合适的局面，从模板库里随机出一个
	提供自动生成模板库功能
	提供模板库预览功能



+填充局面策略
	如果不允许形成Match
		最大尝试次数50次，超过50次则允许形成Match
	填充局面成功后
	至少保证1次不是死局，



引爆特效块，但是特效块上有附着物时怎么处理


74关裁剪有问题
81关附着物的status一直是destruct导致卡死

描述指引不能遮住滑块



实时局面
	UpdateGravity
	CheckSituation

非实时局面
	1.消除
	2.补子下落
	3.查找可消除元素
		有可消除回到步骤1
		没有可消除继续
	4.判定关卡是否结束
		关卡结束，BonusTime
		关卡未结束继续
	5. 1）尝试引爆所有的河豚炸弹
			如果有河豚炸弹回到步骤1
		2）尝试鸡窝释放技能
			如果释放了技能回到步骤3
		3）尝试释放大眼仔技能
			如果释放完了技能，继续往下走
		4）尝试移动灰毛球
			如果移动了灰毛球，回到步骤3
		5）尝试移动老鼠
			如果移动了老鼠，继续往下走
		6）尝试扩散毒液
			如果扩散了毒液，继续往下走
		7）尝试改变变色球颜色
			如果改变了变色球颜色，继续往下走
	6.查找Move, UpdateMove
		如果有Move，回合结束
		如果没有Move，刷新局面，回到步骤3



XMatchController中记录所有正在移动的滑块，滑块


消除-》补子下落-》查找消除



XLevelManager判定子关卡结束
	触发onPreHandleSubLevelFinishedEvent
		XGameEventController.OnPreHandleSubLevelFinished
回调XLevelManager.HandleSubLevelFinished，
	如果是最后一个子关卡，触发onPreHandleLevelFinishedEvent
		XGameEventController.OnPreHandleLevelFinished
		回调XLevelManager.HanddleLevelFinished
			触发onPostHandleLevelFinished
	如果不是最后一个子关卡...


删除XBaseKittyInfo
kittyInfo掉落完
	


结算界面功能测试：
	关卡失败界面，
		重新玩			OK
		返回地图		OK
	暂停界面
		重新玩			OK
		返回地图		OK
	关卡死局界面
		重新玩			OK
		返回地图		OK
	关卡胜利界面
		重新玩			OK
		下一关			OK
		返回地图		OK






物体基础功能
	// 1-30 滑块
    Normal = 1,             	OK
    VerticalBomb = 2,       	OK
    HorizonBomb = 3,        	OK
    RhombicBomb = 4,        	OK
    UniversalColor = 5,     	OK
    Banana = 6,             	OK
    PresentBox = 12,        	OK
    Chameleon = 13,         	OK
    TimeRecover = 14,      		OK
    Mouse = 31,					OK
    MouseHole = 32,				OK
    Bush = 33,					OK
    PoisonousJelly = 35,		OK
    Ice = 61,					OK
    GrayFurBall = 92,			OK
    Vine = 93,					OK
    Lolly = 121,				OK
    MeatBlock = 122,			


特效混合功能
	彩虹+普通 		OK
	彩虹+菱形 		OK
	彩虹+条纹		OK
	彩虹+彩虹 		OK
	条纹+条纹		OK
	条纹+菱形 		OK
	菱形+菱形 		OK











bug:
	1.关卡一开始就会触发levelstart的指引，关卡1，一开始就checkSitation，并调用了AfterPostLoadSubLevel.
	2.使用锤子锤礼物盒，hitInfo的coordArry为空，难道礼物盒的corodList为空？26关
	3.90关有滑块的GameObject没有被回收
	4.123关用锤子砸掉一个滑块后，消除了一块冰棒，但是没有滑块落下来，没有刷新gravity
	5.步数快消耗完时，临时道具的提示的层级比失败界面高
	6.剩余步数太多没有触发将步数转化成特效
	7.开局如果有消除，则不会刷新局面




非即时模式
	有格子空出来并且可以添加滑块的时候，
	 	此时如果局面已经静止，则直接SpawnAndGravity，否则标记gravity为dirty
	当ItemInfo的状态改变时，扫描局面，如果局面已经静止，则直接spawnAndGravity

	spawnAndGravity结束后，即所有的滑块都掉落完毕时，CheckSituation.


所有会创建新滑块的地方
	levelManager加载关卡 				关卡都加载完刷新局面
	gravityManager补块					滑块都运动完刷新局面
	blockEmitterInfo发射新滑块			滑块都发射完刷新局面
	AddMergeKitty添加合成新滑块			






	使用完道具
		强制交换道具
			交换玩重新检测局面
		小木槌：
			消除完，如果格子能补滑块，则更新重力
			如果消除的是滑块，并且滑块是某个Move的滑块，并且格子无法补滑块则刷新局面，
		魔法棒：
			变成菱形炸弹后，如果滑块是某个Move的滑块，刷新局面

	ProcessMove
		->ProcessSolution		
		->非即时模式，
			等所有的消除都结束了，更新重力
			等重力更新完刷新局面，
	    ->即时模式，
	    	当有GameItem消除时，如果格子可以补块，则更新重力（）
	    	如果是最后一个消除时，如果消除的是滑块，并且滑块是某个Move的滑块，并且格子无法补滑块则刷新局面
	    	如果有滑块已经落到格子，如果是香蕉则直接消除，否则尝试查找新补的滑块是否能消除




检测局面：
	1.查找现成的三消，
		有消除，返回
		没有，继续往下
	2.局面是否静止，
		非静止，分会
		静止，继续往下
	3.关卡结果检测
		关卡已结束，返回
		关卡未结束， 继续
	4.